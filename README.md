# Система управления банковскими картами

Данный сервис предоставляет REST API для управления банковскими картами. 
Он позволяет создавать, просматривать, обновлять и удалять информацию о банковских картах.

# Сущности

## Card
- У карты есть все атрибуты согласно тз. Дата истечения срока действия карты реализована двумя полями: месяц и год.
## User
- У пользователя есть атрибуты: логин, пароль (зашифрованный), множество ролей (ADMIN или USER).

# Security
- Аутентификация и авторизация реализованы с помощью Spring Security и JWT. Есть два токена: access и refresh. Access токен живет 5 минут, refresh - 7 дней. Есть возможность обновить access токен по refresh токену. Параметры жизни токенов можно настроить в application.yml. Короткоживущий access токен позволяет снизить риски, связанные с его компрометацией. В случае чего refresh токен отзывается и access токен быстро истекает, минимизируя время, в течение которого злоумышленник может использовать его для несанкционированного доступа. Можно было бы реализовать WhiteList токенов, но это сильно нагрузило бы систему и усложнило архитектуру, поэтому я от этого отказался в пользу сохранения главного преймущества JWT - отсутствия состояния на сервере. Роли: ADMIN и USER. Админ может управлять всеми картами и пользователями, пользователь - только своими картами.
- Пароли хранятся в зашифрованном виде с помощью BCryptPasswordEncoder.
- Номера карт хранятся в зашифрованном виде с помощью AES. В ответах API номера карт маскируются, показывая только последние 4 цифры. По этой причине во время тестов, лучше не терять номер карты.
Всё это гарантирует, что даже если наши БД утекут или к ним будет получен доступ, то расшифровать данные будет крайне сложно.

# Возможности
## Администратор:
- Создаёт, блокирует, активирует, удаляет карты
- Управляет пользователями(создание, удаление, отключение, изменение ролей)
- Видит все карты
- Просматривает всех пользователей
- Фильтрация и постраничная выдача карт и пользователей
- Обработка запросов на блокировку карт от пользователей(в тз было не очень понятно, цитата "Запрашивает блокировку карты", поэтому я реализовал так, что юзер может отправить запрос на блокировку карты, а админ уже решает, блокировать карту или нет)

## Пользователь:
- Просматривает свои карты (поиск + пагинация)
- Запрашивает блокировку карты
- Делает переводы между своими картами
- Смотрит баланс

# Бизнес Логика
- CRUD для карт
- Фильтрация и постраничная выдача
- Валидация и сообщения об ошибках
- Шифрование данных
- Ролевой доступ

# БД
- Используется PostgreSQL
- Spring Data JPA для взаимодействия с БД
- Миграции с помощью Liquibase
- Начальные данные для тестов и админа создаются с помощью миграций Liquibase

# Документация
- Документация Swagger UI, OpenAPI
- Для запуска приложения инструкция находится в самом низу этого файла

# Тесты
- Юнит тесты для сервисного слоя с покрытием 85%
- Интеграционные тесты для контроллеров с покрытием 43%(Крайне сложно тестировать контроллеры из-за необходимости аутентификации и авторизации, поэтому покрытие ниже, чем хотелось бы, но я старался покрыть всё что умею и максимально правильно)

# Развертывание
- Dockerfile для контейнеризации приложения
- docker-compose.yml для запуска приложения вместе с PostgreSQL, также для удобства мониторинги и теста добавлен admminer.


# Запуск приложения
1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/lopata29435/bank_REST.git
   cd bank_REST
   ```
   
2. Запустите Docker Compose:
   ```bash
   docker-compose up --build
   ```
3. Приложение будет доступно по адресу: `http://localhost:8080/api`
4. документация Swagger UI по адресу: `http://localhost:8080/api/swagger-ui/index.html#`
